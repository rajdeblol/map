<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ritual Pixel Portal — final</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --cell-size:15px;
      --grid-size:60;
      --logo-scale:1.12;     /* MUST match LOGO_SCALE in script.js */
      --neon: #7fff9a;
    }
    html,body{height:100%;margin:0;background:#02040a;font-family:Orbitron,Arial;color:#bfeccf}
    .app{display:flex;height:100vh}
    .sidebar{width:320px;padding:26px;background:#04121a;border-right:1px solid rgba(0,255,120,0.03)}
    .title{font-size:20px;color:var(--neon);font-weight:700;margin-bottom:12px}
    .counter{background:rgba(0,0,0,0.12);padding:16px;border-radius:10px;margin-bottom:12px}
    .counter .label{font-size:12px;color:rgba(200,255,200,0.45)}
    .counter .big{font-size:36px;color:var(--neon);font-weight:700;margin-top:6px}
    .hint{font-size:13px;color:rgba(180,255,200,0.6);margin-top:12px}

    .canvas-wrap{flex:1;display:flex;align-items:center;justify-content:center;padding:28px}
    .board{position:relative;width:920px;height:920px;background:#02040a;border-radius:8px;padding:14px;box-shadow:0 30px 80px rgba(0,0,0,0.6)}

    /* grid + logo stack */
    .grid-wrap{position:relative;margin:auto;width: calc(var(--grid-size) * var(--cell-size)); height: calc(var(--grid-size) * var(--cell-size));}
    #logoImg{
      position:absolute; inset:0;
      width:calc(100% * var(--logo-scale));
      height:calc(100% * var(--logo-scale));
      left: calc((1 - var(--logo-scale)) * 50%);
      top: calc((1 - var(--logo-scale)) * 50%);
      object-fit:contain; display:block; z-index:0; pointer-events:none; filter:brightness(.68);
    }

    .grid{
      --cols: 60;
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: repeat(var(--cols), var(--cell-size));
      grid-auto-rows: var(--cell-size);
      position:absolute; left:0; top:0; z-index:1;
      box-shadow: inset 0 0 0 9999px rgba(0,0,0,0.18);
      border:2px solid rgba(0,255,120,0.02);
    }

    .cell{ width:var(--cell-size); height:var(--cell-size); box-sizing:border-box; border:1px solid rgba(0,255,120,0.03); background:transparent; position:relative; transition: transform .08s, box-shadow .12s; overflow:hidden; }
    .cell.hoverable{cursor:pointer}
    .cell.empty:hover{transform:scale(1.06); box-shadow:0 0 10px rgba(0,255,120,0.06)}
    .cell.filled{border:1px solid rgba(0,255,120,0.12)}
    .cell .cell-avatar{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:2px;pointer-events:none;display:block}

    .mask-debug{outline:1px solid rgba(0,255,120,0.12); background:rgba(0,255,120,0.02)}

    /* modal */
    .modal, .view-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:220}
    .modal.hidden, .view-modal.hidden{display:none}
    .modal-inner, .view-inner { background: linear-gradient(180deg,#041219,#031018); padding:18px;border-radius:12px;border:1px solid rgba(0,255,120,0.06); width:520px; max-width:94vw; color:#e8fff0; position:relative; box-shadow:0 10px 50px rgba(0,0,0,0.6) }
    .close{position:absolute;right:12px;top:10px;background:transparent;border:0;color:#fff;font-size:20px;cursor:pointer}
    input, textarea { width:100%; padding:10px;border-radius:8px;border:1px solid rgba(0,255,120,0.05); background:#071621; color:#e8fff0; margin-top:8px }
    .place{background:linear-gradient(90deg,#00ff88,#00c77a);border:0;color:#042014;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer}
    .tertiary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#cfeee0;padding:8px;border-radius:8px;cursor:pointer}

    .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 26px; background: rgba(0,0,0,0.75); color: #dfffe8; padding: 10px 14px; border-radius: 999px; font-family: inherit; font-size: 13px; z-index: 400; display:none }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="title">Ritual</div>

      <div class="counter">
        <div class="label">TOTAL CELLS (logo)</div>
        <div id="totalPixels" class="big">0</div>
      </div>
      <div class="counter">
        <div class="label">PIXELS FILLED</div>
        <div id="filledPixels" class="big">0</div>
      </div>

      <div class="hint">Only cells inside the lit logo accept placements. Click a filled cell to view pledge.</div>

      <div style="margin-top:18px">
        <button id="toggleMaskDebug" class="tertiary">Toggle mask overlay</button>
        <div style="height:12px"></div>
        <button id="autoTune" class="tertiary">Auto-tune</button>
      </div>
    </aside>

    <main class="canvas-wrap">
      <div class="board">
        <div class="grid-wrap" style="--grid-size:60; --cell-size:15px;">
          <img id="logoImg" src="assets/logo/ritual-logo.png" alt="logo" />
          <div id="gridContainer" class="grid" style="--cols:60; --cell-size:15px;"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Placement modal -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-inner">
      <button id="closeModal" class="close" aria-label="close">×</button>
      <h3 style="color:var(--neon)">Ritualise Yourself</h3>

      <label>X (Twitter) Username</label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="username" placeholder="yourXhandle (no @)" />
        <button id="fetchAvatar" class="place" style="padding:8px 10px">Fetch</button>
      </div>

      <div id="avatarPreviewWrap" style="margin-top:10px;display:none;align-items:center;gap:10px">
        <img id="avatarPreview" width="48" height="48" style="border-radius:8px;border:1px solid rgba(255,255,255,0.06)" />
        <div style="display:flex;flex-direction:column">
          <div id="avatarName" style="font-size:13px;color:#cfe3ff"></div>
          <button id="removeAvatar" class="tertiary">Remove</button>
        </div>
      </div>

      <label style="margin-top:10px">Or upload avatar</label>
      <input id="avatarUpload" type="file" accept="image/*" />

      <label>Caption / Pledge</label>
      <textarea id="caption" placeholder="I pledge..."></textarea>

      <div style="margin-top:12px;display:flex;justify-content:flex-end">
        <button id="placeBtn" class="place">Place Pixel</button>
      </div>
    </div>
  </div>

  <!-- View modal -->
  <div id="viewModal" class="view-modal hidden" role="dialog" aria-modal="true">
    <div class="view-inner modal-inner">
      <button id="viewClose" class="close">×</button>
      <h3 style="color:var(--neon)">Ritual Member</h3>
      <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
        <img id="viewAvatar" width="64" height="64" style="border-radius:8px;border:1px solid rgba(255,255,255,0.06)" />
        <div>
          <div id="viewHandle" style="font-weight:700"></div>
          <div id="viewPledge" style="margin-top:8px;color:#cfeee0;max-width:380px;word-wrap:break-word"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="script.js"></script>
</body>
</html>
